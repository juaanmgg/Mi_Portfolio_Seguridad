# Write-up: Basic Pentesting (TryHackMe) 
 
**Autor:** Juan Merino Garrido
**Plataforma:** TryHackMe 
**Máquina:** Basic Pentesting 
**Dificultad:** Fácil 
 
Este write-up detalla una máquina fundamental para la preparación del eJPTv2, ya que se enfoca en la enumeración cruzada entre servicios, el pivoteo de usuarios y el cracking de claves SSH. 
 
--- 
 
## 1. Reconocimiento y Escaneo 
 
El escaneo inicial con `nmap` reveló una superficie de ataque interesante, incluyendo servicios web y SMB. 

 **Comando:**
 
Bash

    sudo nmap -sV -sC -p- --open <IP> 
 

Resultados Clave: 

    Puerto 80/tcp: HTTP (Apache) 

    Puerto 445/tcp: SMB (Samba) 

    Puerto 22/tcp: SSH (OpenSSH) 

    Puerto 8080/tcp: HTTP (Apache Tomcat) 

 

## 2. Enumeración 

La enumeración se realizó en múltiples vectores. 

 ### Vector A: Web (Puerto 80) 

Un escaneo de directorios con dirb o gobuster reveló un directorio oculto: 

http://<IP>/development 
 

Dentro, se encontraron archivos de texto donde los desarrolladores jan y kay dejaban notas. Esto confirmó dos nombres de usuario válidos. 

### Vector B: SMB (Puerto 445) 

Sabiendo los nombres de usuario, se intentó un ataque de fuerza bruta. Hydra falló debido a problemas con el protocolo SMBv1. 

Se utilizó crackmapexec, que auto-negocia la versión de SMB: 

Bash 

    crackmapexec smb <IP> -u users.txt -p /usr/share/wordlists/rockyou.txt 
 

Resultado: crackmapexec encontró una contraseña para SMB: jan:123456. 

Trampa: Esta contraseña era una "trampa". Funcionaba en SMB pero era la respuesta incorrecta para la máquina, sugiriendo que los usuarios tenían contraseñas diferentes para servicios diferentes. 

 

## 3. Obtención de Acceso (Usuario 'jan') 

Dado que las credenciales de SMB eran un callejón sin salida, se probó la fuerza bruta contra el servicio SSH con el usuario jan. 

Comando (Hydra): 

Bash 

    hydra -l jan -P /usr/share/wordlists/rockyou.txt <IP> ssh 
 

Resultado: 

Hydra tuvo éxito y reveló la contraseña de jan para SSH: armando 

Con esta credencial, se obtuvo acceso a la máquina: 

Bash 

    $ ssh jan@<IP> 
    Password: armando 
    ... 
    jan@basic-pentesting:~$  
 

 

## 4. Pivoteo Interno (Usuario 'kay') 

Una vez dentro como jan, comenzó la fase de post-explotación. El comando sudo -l no reveló nada, por lo que el siguiente paso fue la enumeración del sistema de archivos. 

Comando: 

Bash 

    jan@basic-pentesting:~$ ls -la /home 
    drwxr-xr-x 1 jan  jan  4096 Jul 30 2020 jan 
    drwxr-xr-x 1 kay  kay  4096 Jul 30 2020 kay 
 

Se descubrió al segundo usuario, kay. Al explorar su directorio (/home/kay), se encontraron archivos de interés: 

    id_rsa: La clave privada SSH de Kay. 

    pass.bak: Un archivo de backup que jan no podía leer. 

Cracking de la Passphrase de SSH 

La clave id_rsa se copió a la máquina atacante. Al intentar usarla, pedía una passphrase. 

### Paso 1: Convertir la clave a Hash 

Se usó ssh2john para convertir la clave a un formato crackeable: 

Bash 

    $ python /usr/share/john/ssh2john.py id_rsa_kay > kay.hash 
 

### Paso 2: Crackear el Hash con John 

Se usó john y rockyou.txt para encontrar la passphrase: 

Bash 

    $ john --wordlist=/usr/share/wordlists/rockyou.txt kay.hash 
    Loaded 1 password hash (SSH [RSA/DSA/ECDSA/OPENSSH]) 
    ... 
    beepwax          (kay) 
 

La passphrase era beepwax. 

 

## 5. Escalada de Privilegios (Root) 

Con la clave id_rsa y la passphrase beepwax, se pudo iniciar sesión como el usuario kay. 

Comando: 

Bash 

    # Corregir permisos de la clave 
    $ chmod 600 id_rsa_kay 
    # Conectar 
    $ ssh -i id_rsa_kay kay@<IP> 
    Enter passphrase for key 'id_rsa_kay': beepwax 
    ... 
    kay@basic-pentesting:~$  
 

Una vez dentro como kay, se tuvo permiso para leer el archivo pass.bak, que contenía la contraseña del usuario root, completando la máquina. 

 

## 6. Conclusiones y Remediación 

    Fuga de Información: Las notas en /development expusieron nombres de usuario. 

    Contraseñas Reutilizadas/Débiles: La contraseña de jan fue encontrada por fuerza bruta. 

    Permisos de Archivos Críticos: El error más grave fue permitir que el usuario jan pudiera leer la clave id_rsa del usuario kay. Las claves privadas nunca deben ser legibles por otros usuarios. 

    Passphrases Débiles: La passphrase de la clave SSH era débil y se crackeó con un diccionario común. 

 
--- 
